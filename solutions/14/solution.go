package solution14

import (
	"advent-of-code/solutions"
	"advent-of-code/utils"
	"strings"
)

type Solution14 struct{}

type Robot struct {
	position   [2]int
	velocities [2]int
}

func (s Solution14) PartA(lineIterator *utils.LineIterator) any {
	robots := parseInput(lineIterator)

	quadrants := [4]int{}
	for _, robot := range robots {
		// Move the robot 100 times
		for range 100 {
			robot = moveRobot(robot)
		}
		// Check the quadrant
		if robot.position[0] < 50 && robot.position[1] < 51 {
			quadrants[0] += 1
		} else if robot.position[0] > 50 && robot.position[1] < 51 {
			quadrants[1] += 1
		} else if robot.position[0] < 50 && robot.position[1] > 51 {
			quadrants[2] += 1
		} else if robot.position[0] > 50 && robot.position[1] > 51 {
			quadrants[3] += 1
		}
	}

	result := 1
	for _, quadrant := range quadrants {
		result *= quadrant
	}
	return result
}

func (s Solution14) PartB(lineIterator *utils.LineIterator) any {
	robots := parseInput(lineIterator)

	robotsMap := [101][103]bool{}
	counter := 0
	for {
		counter += 1
		// For each robot, move it and update its position on the map
		for i := 0; i < len(robots); i++ {
			robot := robots[i]
			robotsMap[robot.position[0]][robot.position[1]] = false
			robot = moveRobot(robot)
			robotsMap[robot.position[0]][robot.position[1]] = true
			robots[i] = robot
		}
		// If a row with 10 robots in a row is found then return the iterations counter
		// (it's just random guessing but it worked)
		// The picture of the Christmas tree Easter egg found is shown as comment at the
		// bottom of the file
		for _, row := range robotsMap {
			streak := 0
			for _, col := range row {
				if streak == 10 {
					return counter
				}
				if col {
					streak += 1
				} else {
					streak = 0
				}
			}
		}
	}
}

func parseInput(lineIterator *utils.LineIterator) []Robot {
	robots := []Robot{}
	for lineIterator.Next() {
		line := lineIterator.Value()
		line = strings.ReplaceAll(line, "p=", "")
		line = strings.ReplaceAll(line, "v=", "")
		positionString := strings.Split(line, " ")[0]
		velocitiesString := strings.Split(line, " ")[1]
		position := utils.StringsToIntegers(strings.Split(positionString, ","))
		velocities := utils.StringsToIntegers(strings.Split(velocitiesString, ","))
		robots = append(robots, Robot{position: [2]int(position), velocities: [2]int(velocities)})
	}
	return robots
}

func moveRobot(robot Robot) Robot {
	robot.position[0] = (robot.position[0] + robot.velocities[0]) % 101
	if robot.position[0] < 0 {
		robot.position[0] = 101 + robot.position[0]
	}
	robot.position[1] = (robot.position[1] + robot.velocities[1]) % 103
	if robot.position[1] < 0 {
		robot.position[1] = 103 + robot.position[1]
	}
	return robot
}

func init() {
	solutions.RegisterSolution(14, Solution14{})
}

/* Christmas tree Easter egg
................................#.................#....................................................
................................................#..................................................#...
.................................#.....#...............................................................
.......................................................................................................
...........#....................................##...........................#.....#...................
........#...............#................................#.............................................
.......................................................................................................
.......................................................................................................
.......................................................................................................
....#..................................................#...............................................
................................................#.......................#......................#.......
........................................#..............................................................
.......................................................................................................
.......................................................................................................
.......................................................................................................
.............................#.........................................................................
........................................................#..............................................
.......................................#..................................................#............
..................................................................#....................#...............
............................................................#..........................................
..........#............................................................................................
.......#.....................#.........#...............................................................
.......#.........#.....................................................................................
...........#............................................#.......................................#......
................................................................................#......................
......................#..............................#.................................................
.............................................................................................#.........
..........#.....#......................................................................................
............................#..........................................................................
....................#....#.............................................................................
........................................................#..............................................
............#....................................#.....................................................
.................................................................................#................#....
....#..................................................#...............................................
.........................................#..................#.......................#......#...........
........................................#..............................................................
#............................#.#................................#.........................#............
................................#....................................#.................................
...............................................................................................#.......
.................#...........#.....................#.....................................#.............
.......................................................................................................
..........................................................#..........................................#.
.#.......#...................................................#.........................................
...........................................................................................#...........
...#..................................................................................................#
.......................................................................................................
................#..............#.................................................#.....................
.........#..................#........#..........................................#........#.............
......................................................#......................#.#.......................
............................................................#..........................................
.......................................................................................................
.......................................................................................................
...............................................#################################.......................
...............................................#...............................#.......................
....................#..........................#...............................#.......................
...............................................#...............................#.......................
.....................##........................#...............................#.......................
.......................#....#..................#.......................#.......#....................#..
..................#............................#......................##.......#.......................
..........#....................................#..................#..###.......#.......................
...............................................#.................##.####.......#.......................
...............................................#.............#..###.####.......#.......................
...........#.......................#...........#............##.#########.......#.......#...............
........................................#......#........#..#############.......#.......................
...............................................#.......##.#######.######.......#...............#.......
....................................#.................#.#.##############.......#..................#....
.............................................#.#.....######################....#.......................
...............................##..............#....###################.###............................
...............................................#.....######################....#.......................
...............................................#......################.#.......#.......................
...............................................#.......##.##############.......#.......................
...............................................#........#..#############.......#.......................
...............................................#............##.#########.......#....................#..
...............................................#.............#..########.......#......................#
...............................................#.................##.####.......#.......................
...............................................#..................#..###.......#.......................
...#...........................................#......................##.......#.......................
............................................#..#.......................#.......#.......................
...............................................#...............................#......#................
#.............#.................#..............#...............................#.......................
...............................................#...............................#.......................
...........................................#...#...............................#.......................
...............................................####################.############.......................
.......#...............................................................................................
.....................................................#...............................................#.
....................#.................................#...............#................................
...........................#...........#...............................................................
..................#...............#....................................................................
............................................#..........................................................
.......................................................................................................
.......................................................................................................
.......................................................................................................
............................................................................#..........................
........................#..............................................................................
.#..##.................................................................................................
..#...........................#.............................................#..........................
.......................................................................................................
...........................................................................#................#..........
......................#.................#..........................#...............................#...
#......................................................................................................
..............................................................#...........#............................
*/
